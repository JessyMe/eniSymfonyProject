{% extends 'layout.html.twig' %}
{%  block style %}<link rel="stylesheet" href="{{ asset('css/style_home.css') }}">{% endblock %}
{% block main %}

    {{ form_start(sortieForm) }}
    <div class="formHome row">
        <div class="formHome col-sm-1 col-lg-5">

            {{ form_row(sortieForm.campus) }}

            {{ form_row(sortieForm.nom) }}
            <div class="form-group">
                <label for="">Entre</label>
                {{ form_row(sortieForm.datedebut) }}
            </div>
            <div class="form-group">
                <label for="">et</label>
                {{ form_row(sortieForm.datefin) }}
            </div>

        </div>
        <div class="formHome-col col-sm-1 col-lg-4">
            {{ form_row(sortieForm.SortieOrganisateur) }}
            {{ form_row(sortieForm.SortieInscrit) }}
            {{ form_row(sortieForm.SortieNonInscrit) }}
            {{ form_row(sortieForm.SortiePassee) }}
        </div>
        <div class="col-sm-1 col-lg-2">
            <div>
                {% if (user) %}
                    Date du jour : {{ 'now' | date('d/m/y') }}
                    Participant : {{ app.user.pseudo }}
                {% endif %}
            </div>
            <button type="submit" class="btn btn-dark">Rechercher</button>
        </div>

    </div>
    {{ form_end(sortieForm) }}


    <table class="table">
        <thead>
        <tr>
            <th scope="col">Nom de la sortie</th>
            <th scope="col">Date de la sortie</th>
            <th scope="col">Clôture</th>
            <th scope="col">Inscrits/places</th>
            <th scope="col">Etat</th>
            <th scope="col">Inscrit</th>
            <th scope="col">Organisateur</th>
            <th scope="col">Actions</th>
        </tr>
        </thead>
        <tbody>
        {% for sortie in sorties %}

        <tr>
            <td>{{ sortie.nom }}</td>
            <td>{{ sortie.datedebut|date('d/m/Y - H:i') }}</td>
            <td>{{ sortie.datecloture|date('d/m/y') }}


            </td>
            <td>
                {% set nbrInscriptions = 0 %}
                {% for inscription in inscriptions %}
                    {% if inscription.sortie.id == sortie.id %}
                        {% set nbrInscriptions = nbrInscriptions + 1 %}
                    {% endif %}
                {% endfor %}
                {{ nbrInscriptions }}/{{ sortie.nbInscriptionMax }}
            </td>
            <td>{{ sortie.etat.libelle }}</td>
            <td>
                {% for inscription in inscriptions %}
                    {% if inscription.sortie.id == sortie.id and inscription.participant.id == app.user.id %}
                        X
                    {% endif %}
                {% endfor %}


            </td>
            <td>{{ sortie.organisateur.pseudo }}</td>
            <td>
                {% if sortie.etat.libelle == 'Créée' and sortie.organisateur.id == app.user.id%}
                <a href="{{ path('sortie_update', {'id' : sortie.id}) }}">Modifier</a>
                <a href="{{ path('sortie_delete', {'id' : sortie.id}) }}">Annuler</a>
                {% endif %}
                {% if sortie.etat.libelle == 'Ouverte' %}
                <a href="{{ path('main_home') }}">S'inscrire</a>
                <a href="{{ path('main_home') }}">Se désinscrire</a>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

<button type="primary-button"><a href="{{ path('sortie_add')}}"> Nouvelle sortie</a></button>
{% endblock %}